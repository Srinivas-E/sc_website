

MODULE_XCC_C_FLAGS = $(XCC_FLAGS) -Os

OPTIONAL_HEADERS += web_server_conf.h

GENERATED_FILES = web_files.c web_server_gen.h

# The following include works around a bug in the 11.11.0 toolchain
# For later versions of the toolchain it should not be needed
include $(CURRENT_MODULE_DIR)/genfix.make

WEB_FILES = $(foreach x,$(call GET_ALL_SUBDIRS,$(WEB_ROOT_DIR)),$(call WILDCARD,$x/*))

WEBFS_TYPE ?= flash

$(GEN_DIR)/website.generated: $(WEB_FILES) $(call UNMANGLE,$(CURRENT_MODULE_DIR)/src/makefs.py) | $(GEN_DIR) $(BIN_DIR)
	@echo "Generating file system for web site"
	@$(call JYTHON,$(call UNMANGLE,$(CURRENT_MODULE_DIR)/src/makefs.py) $(WEB_ROOT_DIR) $(GEN_DIR)/web_files.c $(WEBFS_TYPE) $(BIN_DIR)/web_data.bin $(GEN_DIR)/web_server_gen.h)
	@echo "generated" > $(GEN_DIR)/website.generated

$(GEN_DIR)/web_files.c : $(GEN_DIR)/website.generated
	@echo "Generated web_files.c"

$(GEN_DIR)/web_server_gen.h : $(GEN_DIR)/website.generated
